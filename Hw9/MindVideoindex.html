<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>MindAR Two Separate Markers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-three.prod.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
                "GLTFLoader": "https://unpkg.com/three@0.150.1/examples/jsm/loaders/GLTFLoader.js"
            }
        }
    </script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        #status {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 14px;
            z-index: 99;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            max-width: 350px;
            font-family: monospace;
        }

        .marker-status {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }

        .marker-active {
            background-color: rgba(0, 255, 0, 0.2);
        }

        .marker-inactive {
            background-color: rgba(255, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div id="loading">
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ AR —Å–∏—Å—Ç–µ–º—ã...</div>
        <div style="font-size: 14px; margin-top: 10px;">–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</div>
    </div>
    
    <div id="status">
        <div id="main-status">–°—Ç–∞—Ç—É—Å: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
        <div id="marker1-status" class="marker-status marker-inactive">–ú–∞—Ä–∫–µ—Ä 1 (marker.mind): 3D –º–æ–¥–µ–ª—å - –ù–ï –ù–ê–ô–î–ï–ù</div>
        <div id="marker2-status" class="marker-status marker-inactive">–ú–∞—Ä–∫–µ—Ä 2 (marker2.mind): –í–∏–¥–µ–æ - –ù–ï –ù–ê–ô–î–ï–ù</div>
        <div style="font-size: 12px; margin-top: 10px;">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã</div>
    </div>

    <script type="module">
        import * as THREE from "three";
        import { GLTFLoader } from "GLTFLoader";

        window.addEventListener("DOMContentLoaded", () => {
            let mindarThree1, mindarThree2;
            let renderer, scene, camera;
            let isInitialized = false;

            const start = async () => {
                try {
                    const { MindARThree } = window.MINDAR.IMAGE;
                    
                    updateMainStatus("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞...");
                    
                    // === –ü–ï–†–í–´–ô –ú–ê–†–ö–ï–† (marker.mind) - 3D –ú–û–î–ï–õ–¨ ===
                    mindarThree1 = new MindARThree({
                        container: document.body,
                        imageTargetSrc: "./marker.mind",
                    });

                    const { renderer: renderer1, scene: scene1, camera: camera1 } = mindarThree1;
                    renderer = renderer1;
                    scene = scene1;
                    camera = camera1;

                    const anchor1 = mindarThree1.addAnchor(0);

                    // –û—Å–≤–µ—â–µ–Ω–∏–µ
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                    scene.add(ambientLight);

                    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    directionalLight.position.set(1, 1, 1);
                    scene.add(directionalLight);

                    // –ó–∞–≥—Ä—É–∑–∫–∞ 3D –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
                    const loader = new GLTFLoader();
                    const modelUrl = "https://raw.githubusercontent.com/hiukim/mind-ar-js/master/examples/image-tracking/assets/band-example/raccoon/scene.gltf";
                    
                    loader.load(
                        modelUrl,
                        (gltf) => {
                            gltf.scene.scale.set(0.1, 0.1, 0.1);
                            gltf.scene.position.set(0, -0.4, 0);
                            gltf.scene.userData.rotationSpeed = 0.01;
                            anchor1.group.add(gltf.scene);
                            console.log("‚úÖ 3D –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–ª—è marker.mind");
                        },
                        undefined,
                        (error) => {
                            console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ 3D –º–æ–¥–µ–ª–∏:", error);
                        }
                    );

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
                    anchor1.onTargetFound = () => {
                        console.log("üéØ –ú–ê–†–ö–ï–† 1 (marker.mind) –ù–ê–ô–î–ï–ù!");
                        updateMarkerStatus(1, true);
                    };

                    anchor1.onTargetLost = () => {
                        console.log("‚ùå –ú–∞—Ä–∫–µ—Ä 1 (marker.mind) –ø–æ—Ç–µ—Ä—è–Ω");
                        updateMarkerStatus(1, false);
                    };

                    updateMainStatus("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ç–æ—Ä–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞...");

                    // === –í–¢–û–†–û–ô –ú–ê–†–ö–ï–† (marker2.mind) - –í–ò–î–ï–û ===
                    mindarThree2 = new MindARThree({
                        container: document.body,
                        imageTargetSrc: "./marker2.mind",
                    });

                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ renderer –∏ scene
                    mindarThree2.renderer = renderer;
                    mindarThree2.scene = scene;
                    mindarThree2.camera = camera;

                    const anchor2 = mindarThree2.addAnchor(0); // –î–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Ñ–∞–π–ª–∞ —ç—Ç–æ –±—É–¥–µ—Ç –∏–Ω–¥–µ–∫—Å 0

                    // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ
                    const video = document.createElement('video');
                    video.crossOrigin = 'anonymous';
                    video.loop = true;
                    video.muted = true;
                    video.playsInline = true;
                    video.preload = 'metadata';
                    
                    // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏ –∫ –≤–∏–¥–µ–æ
                    const videoPaths = [
                        './video.mp4',
                        '/video.mp4',
                        'video.mp4',
                        'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4'
                    ];
                    
                    let videoLoaded = false;
                    let currentVideoIndex = 0;

                    // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ –ø–ª–æ—Å–∫–æ—Å—Ç–∏
                    const videoTexture = new THREE.VideoTexture(video);
                    videoTexture.minFilter = THREE.LinearFilter;
                    videoTexture.magFilter = THREE.LinearFilter;
                    
                    const videoMaterial = new THREE.MeshBasicMaterial({
                        map: videoTexture,
                        side: THREE.DoubleSide
                    });
                    
                    const videoGeometry = new THREE.PlaneGeometry(1, 0.6);
                    const videoMesh = new THREE.Mesh(videoGeometry, videoMaterial);
                    videoMesh.position.set(0, 0, 0.1);
                    
                    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
                    const indicatorGeometry = new THREE.PlaneGeometry(1.2, 0.8);
                    const indicatorMaterial = new THREE.MeshBasicMaterial({
                        color: 0xff0000,
                        transparent: true,
                        opacity: 0.3,
                        side: THREE.DoubleSide
                    });
                    const indicatorMesh = new THREE.Mesh(indicatorGeometry, indicatorMaterial);
                    indicatorMesh.position.set(0, 0, 0.05);
                    
                    anchor2.group.add(indicatorMesh);
                    anchor2.group.add(videoMesh);

                    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ
                    const tryLoadVideo = (index) => {
                        if (index >= videoPaths.length) {
                            console.error("‚ùå –í—Å–µ –ø—É—Ç–∏ –∫ –≤–∏–¥–µ–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏");
                            const colorMaterial = new THREE.MeshBasicMaterial({
                                color: 0x00ff00,
                                side: THREE.DoubleSide
                            });
                            videoMesh.material = colorMaterial;
                            return;
                        }
                        
                        const path = videoPaths[index];
                        console.log(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${path}`);
                        video.src = path;
                        video.load();
                    };

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∏–¥–µ–æ
                    video.addEventListener('loadeddata', () => {
                        console.log(`‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${video.src}`);
                        videoLoaded = true;
                    });

                    video.addEventListener('error', (e) => {
                        console.error(`‚ùå –û—à–∏–±–∫–∞ –≤–∏–¥–µ–æ ${video.src}`);
                        currentVideoIndex++;
                        tryLoadVideo(currentVideoIndex);
                    });

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
                    anchor2.onTargetFound = () => {
                        console.log("üéØ –ú–ê–†–ö–ï–† 2 (marker2.mind) –ù–ê–ô–î–ï–ù!");
                        updateMarkerStatus(2, true);
                        indicatorMesh.material.color.setHex(0x00ff00);
                        
                        if (videoLoaded) {
                            video.play().catch(e => console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:", e));
                        }
                    };

                    anchor2.onTargetLost = () => {
                        console.log("‚ùå –ú–∞—Ä–∫–µ—Ä 2 (marker2.mind) –ø–æ—Ç–µ—Ä—è–Ω");
                        updateMarkerStatus(2, false);
                        indicatorMesh.material.color.setHex(0xff0000);
                        video.pause();
                    };

                    // –ó–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∑–∫–∏
                    tryLoadVideo(0);

                    // –ó–∞–ø—É—Å–∫ –æ–±–æ–∏—Ö —Å–∏—Å—Ç–µ–º
                    updateMainStatus("–ó–∞–ø—É—Å–∫ AR –∫–∞–º–µ—Ä—ã...");
                    
                    await mindarThree1.start();
                    await mindarThree2.start();
                    
                    updateMainStatus("‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞! –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã");
                    isInitialized = true;

                    // –¶–∏–∫–ª —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
                    renderer.setAnimationLoop(() => {
                        // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è 3D –º–æ–¥–µ–ª–∏
                        anchor1.group.children.forEach(child => {
                            if (child.userData && child.userData.rotationSpeed) {
                                child.rotation.y += child.userData.rotationSpeed;
                            }
                        });

                        renderer.render(scene, camera);
                    });

                } catch (error) {
                    console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:", error);
                    updateMainStatus("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏");
                }
            };

            // –§—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
            function updateMainStatus(message) {
                const statusDiv = document.getElementById('main-status');
                if (statusDiv) {
                    statusDiv.textContent = `–°—Ç–∞—Ç—É—Å: ${message}`;
                }
            }

            function updateMarkerStatus(markerNum, isActive) {
                const statusDiv = document.getElementById(`marker${markerNum}-status`);
                if (statusDiv) {
                    const markerName = markerNum === 1 ? 'marker.mind' : 'marker2.mind';
                    const content = markerNum === 1 ? '3D –º–æ–¥–µ–ª—å' : '–í–∏–¥–µ–æ';
                    const status = isActive ? '–ù–ê–ô–î–ï–ù' : '–ù–ï –ù–ê–ô–î–ï–ù';
                    
                    statusDiv.textContent = `–ú–∞—Ä–∫–µ—Ä ${markerNum} (${markerName}): ${content} - ${status}`;
                    statusDiv.className = `marker-status ${isActive ? 'marker-active' : 'marker-inactive'}`;
                }
            }

            // –ó–∞–ø—É—Å–∫
            start().catch(console.error);

            // –°–∫—Ä—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
            setTimeout(() => {
                const loading = document.getElementById("loading");
                if (loading) loading.style.display = "none";
            }, 5000);
        });
    </script>
</body>
</html>